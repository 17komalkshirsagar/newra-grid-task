import{i as z,aw as J,r as t,ax as K,ay as O,az as X,w as Y,au as Z,j as e,B as b,aA as ee}from"./index-Cl1SQMCp.js";import{u as se,t as te,o as ae,e as U,s as _}from"./zod-Cx2om5l9.js";import{t as i}from"./index-MnOYjBE-.js";import{L as y}from"./label-DJCwXsjE.js";import{C as ie,a as oe,b as re,d as ne}from"./card-mR9xUq05.js";import{T as ce}from"./textarea-G-lwuaAY.js";import{I as le}from"./icons-DO8VyPGD.js";import"./leaf-DQch67_8.js";import"./briefcase-ChOFTStc.js";const me=ae({customer:_().min(1,"Customer is required"),type:U(["email","whatsapp"],{required_error:"Type is required"}),message:_().optional(),status:U(["Sent","Failed"],{required_error:"Status is required"})}),Ne=()=>{var L;const{id:o}=z(),k=J(),{customerId:j}=k.state||{},{register:h,handleSubmit:q,reset:n,getValues:S,formState:{errors:l}}=se({resolver:te(me),defaultValues:{customer:"",type:"email",message:"",status:"Sent"}}),[m,f]=t.useState(j||""),[C,u]=t.useState(""),[M,{isSuccess:E,isError:v,isLoading:g}]=K(),[P,{isSuccess:I,isError:F,isLoading:$}]=O(),{data:d}=X(o,{skip:!o}),{data:a}=Y({}),{data:p}=Z(m,{skip:!m});t.useEffect(()=>{o&&d&&n({customer:d.customer,type:d.type,message:d.message||"",status:d.status})},[o,d,n]),t.useEffect(()=>{var s,c;if(m&&(a!=null&&a.result)&&p){const r=a.result.find(x=>x._id===m),N=(r==null?void 0:r.name)||"",G=(r==null?void 0:r.mobile)||"";u(G);const w=p.totals||{totalAmount:0,paidAmount:0,pendingAmount:0},A=p.purchaseInfo||{},H=((s=p.result)==null?void 0:s.length)||0,T=[];(c=p.result)==null||c.forEach(x=>{const D=x.date||x.createdAt,V=D?new Intl.DateTimeFormat("en-IN",{day:"2-digit",month:"long",year:"numeric"}).format(new Date(D)):"---";x.products.forEach(W=>{T.push(`${W.product.name} (${V})`)})});const Q=T.join(", "),R=`प्रिय ${N},

केदार कृषी सेवा तर्फे नम्र विनंती आहे की आपण आपले शिल्लक रक्कम लवकरात लवकर भरावी. आपण केदार कृषी सेवा कडून ${A.firstDate||"---"} ते ${A.lastDate||"---"} दरम्यान खरेदी केली आहे. आपली एकूण खरेदी रक्कम ₹${w.totalAmount} असून यापैकी ₹${w.paidAmount} भरले असून ₹${w.pendingAmount} शिल्लक आहे.

आपण एकूण ${H} बिल झालेले आहेत. खरेदी उत्पादने: ${Q}.

कृपया आपली थकबाकी रक्कम लवकरात लवकर भरा.

धन्यवाद!
केदार कृषी सेवा`;n({...S(),customer:m,message:R})}},[m,a,p,n]),t.useEffect(()=>{!o&&!j&&(n({customer:"",type:"email",message:"",status:"Sent"}),f(""),u(""))},[o,j,n]),t.useEffect(()=>{E&&i.success("Notification created successfully")},[E]),t.useEffect(()=>{v&&i.error("Failed to create notification")},[v]),t.useEffect(()=>{g&&i.info("Creating notification...")},[g]),t.useEffect(()=>{g&&i.dismiss("create-notification")},[g]),t.useEffect(()=>{I&&i.success("Notification updated successfully")},[I]),t.useEffect(()=>{F&&i.error("Failed to update notification")},[F]),t.useEffect(()=>{$&&i.info("Updating notification...")},[$]);const B=async s=>{try{o?(await P({id:o,data:s}),i.success("Notification updated")):(await M(s),i.success("Notification sent")),n({customer:"",type:"email",message:"",status:"Sent"}),f(""),u("")}catch{i.error("Something went wrong")}};return e.jsx("div",{className:"max-w-3xl mx-auto py-8",children:e.jsxs(ie,{children:[e.jsxs(oe,{className:"flex items-center justify-center",children:[e.jsx(le.mail,{className:"h-10 w-10 text-blue-600 mb-2"}),e.jsx(re,{children:o?"Update Notification":"Send Notification"})]}),e.jsx(ne,{children:e.jsxs("form",{onSubmit:q(B),className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(y,{htmlFor:"customer",children:"Customer"}),e.jsxs("select",{id:"customer",...h("customer"),onChange:s=>{const c=s.target.value;f(c);const r=a==null?void 0:a.result.find(N=>N._id===c);u((r==null?void 0:r.mobile)||"")},className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"",children:"Select customer"}),(L=a==null?void 0:a.result)==null?void 0:L.map(s=>e.jsx("option",{value:s._id,children:s.name},s._id))]}),l.customer&&e.jsx("p",{className:"text-red-500 text-sm",children:l.customer.message})]}),e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(y,{htmlFor:"type",children:"Type"}),e.jsxs("select",{id:"type",...h("type"),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"email",children:"Email"}),e.jsx("option",{value:"whatsapp",children:"WhatsApp"})]}),l.type&&e.jsx("p",{className:"text-red-500 text-sm",children:l.type.message})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"message",children:"Message"}),e.jsx(ce,{id:"message",rows:4,...h("message")})]}),e.jsxs("div",{className:"flex flex-wrap justify-between items-end gap-3 mt-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx(y,{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",...h("status"),className:"w-full border rounded px-3 py-2",children:[e.jsx("option",{value:"Sent",children:"Sent"}),e.jsx("option",{value:"Failed",children:"Failed"})]}),l.status&&e.jsx("p",{className:"text-red-500 text-sm",children:l.status.message})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(b,{type:"button",className:"bg-red-600 ",variant:"outline",onClick:()=>{n({customer:"",type:"email",message:"",status:"Sent"}),f(""),u("")},children:"Cancel"}),e.jsx(b,{type:"button",className:"bg-green-600 flex items-center gap-2",onClick:()=>{const s=S("message")||"Hello! Please pay your remaining amount.";if(C){const c=`https://wa.me/91${C}?text=${encodeURIComponent(s)}`;window.open(c,"_blank"),n({customer:"",type:"email",message:"",status:"Sent"}),f(""),u("")}else i.error("Please select a customer with a mobile number.")},children:e.jsx(ee,{className:"text-white"})}),e.jsx(b,{className:"bg-green-500 ",type:"submit",children:o?"Update":"Send"})]})]})]})})]})})};export{Ne as default};
