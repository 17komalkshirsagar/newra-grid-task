import{u as M,r as a,w as U,x as z,y as G,z as V,j as s}from"./index-Cl1SQMCp.js";import{t as o}from"./index-MnOYjBE-.js";import{T as b}from"./toast-DZZ6LTTs.js";import{L as $}from"./Loader-BikfMRdt.js";import{T as R}from"./TableData-CyOfLgzd.js";import{u as q}from"./useDebounce-CfTSEcaX.js";import{B as H}from"./briefcase-ChOFTStc.js";import"./index-7vMckiJz.js";import"./index-zu5Pjoey.js";import"./index-BPJnJB5S.js";import"./CustomerHistory-BGs4THpq.js";import"./card-mR9xUq05.js";import"./badge-Duqbj1_E.js";import"./emailSendReceipt.api-LrsuY_7X.js";import"./label-DJCwXsjE.js";import"./zod-Cx2om5l9.js";import"./InstallmentAccordion-D9aMCyou.js";import"./chevron-down-CZWChAHx.js";const me=()=>{var h;const c=M(),[l,C]=a.useState(""),y=q(l,500),[n,j]=a.useState({pageIndex:0,pageSize:10}),[k,S]=a.useState([]),{data:r,isLoading:N,isSuccess:u,refetch:v}=U({searchQuery:y.toLowerCase(),page:n.pageIndex+1,limit:n.pageSize}),[E,B]=a.useState(null),[D,{isSuccess:d,isError:m,isLoading:g}]=z(),[w,{isSuccess:p,isError:x,isLoading:f}]=G(),[L,{data:I,error:P,isSuccess:T,isError:A}]=V(),F=()=>{u&&S(r.result)},Q=async e=>{await w(e)},_=async(e,t)=>{try{const i=await D(e);console.log(t?"Customer unblocked":"Customer blocked",i),await v()}catch(i){console.error("Failed to toggle customer block status",i)}},K=[{accessorKey:"name",header:"Customer Name",cell:e=>e.getValue()},{accessorKey:"mobile",header:"Phone Number",cell:e=>e.getValue()},{accessorKey:"address",header:"Address",cell:e=>e.getValue()},{accessorKey:"status",header:"Status",cell:({row:e})=>{const t=e.original.status,i=()=>{L({id:e.original._id,status:t==="active"?"inactive":"active"})};return a.useEffect(()=>{d&&o.success("Customer blocked successfully")},[d]),a.useEffect(()=>{p&&o.success("Customer deleted successfully")},[p]),a.useEffect(()=>{m&&o.error(" Failed to block Customer")},[m]),a.useEffect(()=>{x&&o.error(" Customer delete successfully")},[x]),a.useEffect(()=>{g&&o.info("Blocking Customer...")},[g]),a.useEffect(()=>{f&&o.info("Blocking Customer...")},[f]),s.jsx("span",{onClick:i,className:`cursor-pointer px-3 py-1 rounded-full text-sm font-semibold ${t==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t==="active"?"Active":"Inactive"})}},{header:"Actions",cell:({row:e})=>{const t=e.original.isBlock;return s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>c(`/customer-page/${e.original._id}`),className:"text-blue-600",children:"Edit"}),s.jsx("button",{onClick:()=>Q(e.original._id),className:"text-red-600",children:"Delete"}),s.jsx("button",{onClick:()=>_(e.original._id,t),className:`font-medium ${t?"text-green-600":"text-yellow-600"}`,children:t?"Unblock":"Block"}),s.jsx("button",{onClick:()=>c("/admin/notification-page",{state:{customerId:e.original._id}}),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"Notify"})]})}}];return a.useEffect(()=>{F()},[u,r]),N?s.jsx($,{}):s.jsxs(s.Fragment,{children:[T&&s.jsx(b,{type:"success",message:I.message}),A&&s.jsx(b,{type:"error",message:P}),s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{className:"flex items-center space-x-2 mt-5",children:[s.jsx(H,{className:"h-6 w-6 text-blue-600"}),s.jsx("h2",{className:"text-lg font-bold",children:"Customers"})]}),s.jsxs("div",{className:"flex gap-2 mt-5",children:[s.jsx("input",{type:"text",placeholder:"Search...",value:l,onChange:e=>C(e.target.value),className:"border px-3 py-1 rounded-md"}),s.jsx("button",{onClick:()=>c("/admin/customer/add"),className:"bg-indigo-600 text-white px-4 py-2 rounded-md",children:"Add"})]})]}),s.jsx("div",{className:"mt-8 flow-root",children:s.jsx("div",{className:"overflow-x-auto sm:-mx-6 lg:-mx-8",children:s.jsx("div",{className:"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8",children:s.jsx(R,{data:k,columns:K,enableSorting:!0,onPaginationChange:j,enableGlobalFilter:!0,onGlobalFilterChange:l,initialPagination:n,totalPages:(h=r==null?void 0:r.pagination)==null?void 0:h.totalPages,expandedCustomerId:E,onExpand:e=>B(t=>t===e?null:e)})})})})]})};export{me as default};
